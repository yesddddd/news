/**
 * Created by yb on 2017/4/5.
 */

//document.onmousemove = mEvn;
//取得位置
//function mEvn() {
//   var x;
//   var y;
//   try {
//       x=event.x;
//       y=event.y;
//   } catch(e){
//       x=arguments[0].x;
//       y=arguments[0].y;
//   }
//  var obj1 = document.getElementById("graphics-js");
//  var top = document.getElementById("graphics-js").getBoundingClientRect().top;
//  var left = document.getElementById("graphics-js").getBoundingClientRect().left;
//  var width = document.getElementById("graphics-js").getBoundingClientRect().width;
//  var height = document.getElementById("graphics-js").getBoundingClientRect().height;
//	//非通版
//	if(x>left&&(x<left+width)&&(y>top)&&(y<top+height)){
//
//		}else{
//				var divElm = document.getElementById("showMap");
//				divElm.style.display = "none";
//				showTitlePane(false);
//		}
//}

$(function(){
    var obj = document.getElementsByName('PagePicMap');
    if ((navigator.userAgent.indexOf('MSIE') >= 0) && (navigator.userAgent.indexOf('Opera') < 0)){
        //alert('你是使用IE')
        obj[0].onmouseover=function(){drawLine(event.srcElement, event);};
        // obj[0].onmouseout=function(){MouseOutMap();};
    }else if (navigator.userAgent.indexOf('Firefox') >= 0){
        // alert('你是使用Firefox')
        obj[0].onmouseover=function(){drawLine(arguments[0].target, arguments[0]);};
        // document.getElementById("leveldiv").onmouseout=function(){MouseOutMap();};
    }else if (navigator.userAgent.indexOf('Opera') >= 0){
        //alert('你是使用Opera')
        obj[0].onmouseover=function(){drawLine(event.srcElement, event);};
        // obj[0].onmouseout=function(){MouseOutMap();};
    }else{
        // alert('你是使用其他的浏览器浏览网页！')
        obj[0].onmouseover=function(){drawLine(event.srcElement, event);};
    }

    // dealFURL();
    // dealTitle(); 这个不是必须的
    // dealAbstInfo();
    // dealAbstInfoPDF();
});
//---处理获取叠信息  左边侧边栏数据（分栏）
function dealFURL(){
    $(".icon li div ul").each(function(){
        var Furl_id=$(this).attr("id");
        var liText = getliTextByFid(Furl_id);
        $(this).append(liText);
    });
}
//--依据叠ID获取叠下LI信息;
function getliTextByFid(id){
    var liArr="";
    $(".hidenPage ."+id).each(function(){
        liArr =liArr+"<LI>"+$(this).html()+"</LI>";
    });
    return liArr;
}
//--处理title 中含有<br>情况；
function dealTitle(){
    $(".main-list li H2 a").each(function(){
        var info = $(this).html();
        while(info.indexOf('<br>')>0||info.indexOf('<BR>')>0){
            info = info.replace('<br>','').replace('<BR>','');
        }
        $(this).html(info);
    });
}
//处理文章列表简要信息;
function dealAbstInfo(){
    $(".summary").each(function(){
        var textInfo =$(this).text();
        if(textInfo.length>80){
            textInfo =textInfo.substring(0,80);
            $(this).html("<p>"+textInfo+"...</p>");
        }

    });
}
loadingPane = null;
var rangeDeltaX = -5;
var rangeDeltaY = -5;
var rangeDeltaXArray = new Array();
var rangeDeltaYArray = new Array();

/* 坐标模式 */
function drawLine(obj,event)
{
    var areaObj = obj;
    // alert(areaObj.attr("href"))
    var str = areaObj.coords;
    var arr = str.split(",");
    var xArr = new Array(arr.length/2);
    var yArr = new Array(arr.length/2);
    var x=0,y=0;
    var max =1,min =2;
    for (var t =0 ;t<arr.length ;t=t+2 )
    {
        xArr[x++] = parseInt(arr[t]);
    }
    for (var t =1 ;t<arr.length ;t=t+2 )
    {
        yArr[y++] = parseInt(arr[t]);
    }
    var x1 = find(xArr,min);
    var x2 = find(xArr,max);
    var y1 = find(yArr,min);
    var y2 = find(yArr,max);
    var mapObj = obj.parentElement || obj.parentNode;
    if(typeof mapObj == "object")
    {
        var imgs = document.getElementsByTagName("img");
        if(imgs != null)
        {
            for(var i=0;i<imgs.length;i++)
            {
                var imgobj = imgs.item(i);
                var mapname = imgobj.useMap;
                if(typeof mapname == "string" && mapname.toLowerCase() == ("#" + mapObj.name).toLowerCase())
                {
                    var imgleft = 0;
                    var imgtop = 0;
                    var imgparent = imgobj.parentElement || imgobj.parentNode;
                    while (imgparent!=null && imgparent!=document.body) {
                        imgleft += getWidthNumber(imgparent.offsetLeft) - getWidthNumber(imgparent.style.borderLeftWidth);
                        imgtop += getWidthNumber(imgparent.offsetTop) - getWidthNumber(imgparent.style.borderTopWidth);
                        imgparent=imgparent.offsetParent;
                    }
                    if(typeof myRangeDeltaX == "number"){
                        imgleft = imgleft + myRangeDeltaX;
                    }else{
                        imgleft = imgleft + rangeDeltaX;
                    }
                    if(typeof myRangeDeltaY == "number"){
                        imgtop = imgtop + myRangeDeltaY;
                    }else{
                        imgtop = imgtop + rangeDeltaY;
                    }
                    MouseOverMap(x1,y1,x2,y2,imgleft,imgtop,areaObj.href);
                }
            }
        }
    }
}

function getWidthNumber(sWidth)
{
    if(typeof sWidth == "number")
        return sWidth;

    var re = /\d+/i;
    var r = sWidth.match(re);
    if(r)
    {
        return parseInt(r);
    }
    else
        return 0;
}

function find(arr,type)
{
    var tmp=arr[0];
    if (type==1)
    {
        for (var loop=0;loop<arr.length ;loop++ )
            if (arr[loop]>tmp)
                tmp = arr[loop];
        return tmp;
    }
    else if (type == 2)
    {

        for (var loop=0;loop<arr.length ;loop++ )
            if (arr[loop]<tmp)
                tmp = arr[loop];
        return tmp;
    }

}

function MouseOverMap(x1,y1,x2,y2,imgleft,imgtop,href) {
    $("#showMap").remove();
    $('.newsconimg').append('<div id="showMap" style="display: block; border: 2px solid rgb(16, 113, 184); opacity: 0.3; position: absolute;background-color: rgb(243, 152, 20);"><a style="width: 100%;height: 100%;display: block;"  href="javascript:void(0)"></a></div>')
    var divElm = document.getElementById("showMap");
    var aElm = divElm.getElementsByTagName("a")[0];
    var Left = x1;
    var Top = y1;
    var Right = parseInt(x2 - x1);
    var bottom = parseInt(y2 - y1);
    var newHref = '../../..' + href.split("paper.aqsc.cn")[1];


    divElm.style.position = "absolute";
    divElm.style.display = "block";
    divElm.style.border = "solid 2px #1071b8";
    divElm.style.left = Left+ "px";
    divElm.style.top = Top+ "px";
    divElm.style.width = Right+ "px";
    divElm.style.height = bottom+10 + "px";
    divElm.style.cursor = "pointer;";
    aElm.style.width = Right+ "px";
    aElm.style.height = bottom+10 + "px";

    $("#showMap a").attr('href',newHref);

    $("#showMap").on('click','a',function(){
        $(".backlist").show();
        var _this=$(this)
        var src="";
        src = newHref;
        var hasClick=_this.attr("data-click");
        if(!hasClick){
            _this.attr("href","javascript:void(0)");
            _this.attr("data-click","true");
            _this.attr("data-href",src);

        }else{
            src = _this.attr("data-href");
        }
        $(".newsconright").css("padding","40px 0 0 0");
        $(".articleContent").show();
        $(".articleContent .articles").attr("src",src);
        $(".newslist ul li").hide();
    })


    // var articleRe = /^\/\w(\.html)l$/;

    // var articleRe = /content_(\d+)\.htm/i;

    // var articleRe = /content_([\s\S]*)\.htm/i;
    // var r = newHref.match(articleRe);
    // var targetId= r[1];

    var hrefPre = newHref.lastIndexOf('\/');
    var hrefNext = newHref.lastIndexOf('.');

    var targetId= newHref.slice(hrefPre + 1,hrefNext);


    //联动对应方法
    PageArticleTitle(targetId);
    $("#showMap").hover(function(){

    },function(){

         $("#showMap").css({
             'display':'none'
         })
        $('.newslist li').removeClass('li-active');
        $('.newslist li h3 a').css({
            'color':''
        })
    });
}

//右侧文章列蒙层
function PageArticleTitle(targetId){


    $(".newslist h3 a").each(function(){
        var articleId = '';
        if($(this).attr("href") != 'javascript:void(0)'){
            articleId=$(this).attr("href");
        }else{
            articleId=$(this).attr("data-href");
        }


        var hrefPre = articleId.lastIndexOf('\/');
        var hrefNext = articleId.lastIndexOf('.');

        var articleId = articleId.slice(hrefPre + 1,hrefNext);

        // console.log(articleId);
        // var articleRe = /content_(\d+)\.htm/i;
        // var r = articleId.match(articleRe);

        if(articleId !=targetId){
            $(this).parent().parent().removeClass("li-active");
            $(this).css({
                'color':''
            })
        }else{
            $(this).parent().parent().addClass("li-active");
            $(this).css({
                'color': '#d1232a'
            })
        }
    });
}
$(document).ready(function() {

    $(".main-list li").hover(
        function () {
            $(this).addClass("li-active");
        },
        function () {
            $(this).removeClass("li-active");
        }
    );
});



function MouseOutMap() {
    var divElm = document.getElementById("showMap");
    // divElm.style.border = "";
    divElm.style.display = "none";
    // showTitlePane(false);
}

function clickmap(obj)
{
    //alert(obj.href);
    //window.open(obj.href,"newwin","toolbar=no,resizable=no,scrollbars=yes,dependent=no,width=700,height=500");
    //obj.target="_blank";
}

//-----打开pdf链接;2-23
function dealAbstInfoPDF(){
    $('.downPDF').click(function(){
        var pdfLink = $('.downPDF a').attr('href');
        window.location.href= pdfLink;
        //window.open(pdfLink,'_blank');
    });
    $('.old_cld').click(function(){
        var oldCldLink ="http://bjwb.bjd.com.cn/html/2015-12/31/node_82.htm";
        window.location.href= oldCldLink;
    });
}

$(function(){
    //检查当前浏览器版本;
    var currHref = location.href;
    if(currHref.indexOf('/node_113.htm')>=0){
        if ( $.browser.msie && $.browser.version<='7.0') {
            alert('您的浏览器版本过低, 为了更好体验,请升级IE浏览器或者选择chrome浏览器!');
        }
    }

    //浏览器当前窗口可视区域宽度
    if($(window).width()<1100){
        var s ='';
        var per_href = $('.toprevblock a').attr('href');
        if(per_href!=null){
            s=s+"<a class='preart_rg' href="+per_href+"><a>"
        }
        var next_href = $('.tonextblock a').attr('href');
        if(next_href!=null){
            s=s+"<a class='nextart_rg' href="+next_href+"><a>"
        }
        $('.to_oe').after(s);
    }
})

//加入判断img大小的方法
// alert(onOff);
// function sizeImg(){
//     var img = new Image();
//     img.src = $(".newsconimg").find('img').eq(0).attr("src");
//     if(img.width < img.height){
//         //小图
//         // onOff = true;
//         $("#linkCss").attr("href","../../../../tqPaper/webcss/layout2.css");
//
//
//     }else{
//         //大图
//         // onOff = false;
//         $("#linkCss").attr("href","../../../../tqPaper/webcss/layout.css");
//
//     }
// }
// $('#iframeBox',$(".articles").contents().context).attr('link',123456)

